---
layout: post
title:  "Howto install Trendmicro DeepSecurity silently"
date:   2022-04-02 07:36:00 +0800
categories: [security]
---
### Requirement
- Install Trendmicro DeepSecurity Manager 20 LTS on RHEL with PostgreSQL co-hosted
- RHEL Env: CLI only

### Method
#### PostgreSQL
- Use packages included in the distribution

  ```
  yum install postgresql-server
  ```

- Prepare the DB

  ```
  sudo su - postgres -c psql

  postgres=# create database "dsmdb";
  CREATE DATABASE
  postgres=# create role "dsmroot" with password 'mysecurepassword' login;
  CREATE ROLE
  postgres=# grant all on database dsmdb to dsmroot;
  GRANT
  postgres=# grant connect on database "dsmdb" to "dsmroot";
  
  ```

#### Silent Installation
- Prepare properties file
  {% highlight ruby %}
  AddressAndPortsScreen.ManagerAddress=<Your Server IP>
  AddressAndPortsScreen.NewNode=True
  UpgradeVerificationScreen.Overwrite=False
  LicenseScreen.License.0=<Your License ID>
  DatabaseScreen.DatabaseType=PostgreSQL
  DatabaseScreen.Hostname=127.0.0.1
  DatabaseScreen.Transport=TCP
  DatabaseScreen.DatabaseName=dsmdb
  DatabaseScreen.Username=dsmroot
  DatabaseScreen.Password=mysecurepassword
  AddressAndPortsScreen.ManagerPort=4119
  AddressAndPortsScreen.HeartbeatPort=4120
  CredentialsScreen.Administrator.Username=masteradmin
  CredentialsScreen.Administrator.Password=mysupersecurepassword
  CredentialsScreen.UseStrongPasswords=False
  SecurityUpdateScreen.UpdateComponents=True
  SecurityUpdateScreen.Proxy=False
  SecurityUpdateScreen.ProxyType=
  SecurityUpdateScreen.ProxyAddress=
  SecurityUpdateScreen.ProxyPort=
  SecurityUpdateScreen.ProxyAuthentication="False"
  SecurityUpdateScreen.ProxyUsername=""
  SecurityUpdateScreen.ProxyPassword=""
  SoftwareUpdateScreen.UpdateSoftware=True
  SoftwareUpdateScreen.Proxy=False
  SoftwareUpdateScreen.ProxyType=
  SoftwareUpdateScreen.ProxyAddress=
  SoftwareUpdateScreen.ProxyPort=
  SoftwareUpdateScreen.ProxyAuthentication="False"
  SoftwareUpdateScreen.ProxyUsername=""
  SoftwareUpdateScreen.ProxyPassword=""
  SoftwareUpdateScreen.ProxyAuthentication="False"
  RelayScreen.Install=True
  SmartProtectionNetworkScreen.EnableFeedback=False
  {% endhighlight %}
  Ref: https://help.deepsecurity.trendmicro.com/20_0/on-premise/manager-install-silent.html#Deep

- Download DSM Installation file from here: https://help.deepsecurity.trendmicro.com/software.html
- Trigger Installation command (Assuming both property file and installation sits in the same directory
  {% highlight ruby %}
  ./Manager-Linux-20.0.198.x64.sh -q -console -varfile ./prop.cfg

  Unpacking JRE ...
  Starting Installer ...
  Unattended (Silent) mode started
  Checking for previous versions of Trend Micro Deep Security Manager...
  Upgrade Verification Screen settings accepted...
  The installation directory has been set to /opt/dsm.
  Database Screen settings accepted...
  The install readiness check is starting.
  Readiness Check Summary report generated into path /tmp/DeepSecurityInstallerReport.csv
  The install readiness check is complete.
  License Screen settings accepted...
  Address And Ports Screen settings accepted...
  Credentials Screen settings accepted...
  Security Update Screen settings accepted...
  Software Update Screen settings accepted...
  Master key configuration settings accepted...
  Smart Protection Network Screen settings accepted...
  All settings accepted, ready to execute...
  Stopping Trend Micro Deep Security Manager Service...
  Extracting files ...
  Setting Up...
  Connecting to the Database...
  Creating Database Schema...
  Creating masteradmin Account...
  Recording Settings...
  Creating Temporary Directory...
  Installing Reports...
  Installing Modules and Plug-ins...
  Validating and Applying Activation Codes...
  Configure Localizable Settings...
  Setting Default Password Policy...
  Creating Scheduled Tasks...
  Creating Asset Importance Entries...
  Creating Auditor Role...
  Optimizing...
  Importing Software Packages...
  Importing Software Package: Agent-RedHat_EL8-20.0.0-1304.x86_64.zip
  Configuring Relay For Install...
  Configuring DSA For Install...
  Importing Performance Profiles...
  Recording Installation...
  Clearing Sessions...
  Creating Properties File...
  Creating Shortcut...
  Configuring SSL...
  Configuring Service...
  Configuring Java Security...
  Configuring Java Logging...
  Cleaning Up...
  Starting Deep Security Manager...

  Finish Installation ...
  {% endhighlight %}
